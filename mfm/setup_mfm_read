#!/bin/bash
dtc -O dtb -o mfm_read-00A0.dtbo -b 0 -@ mfm_read-00A0.dts
cp mfm_read-00A0.dtbo /lib/firmware
echo mfm_read:00A0 > /sys/devices/bone_capemgr.*/slots
# 44 emu second driver emulation, disable
# 60 MFM emulation tranceiver enable, high is disabled
pins="44 60"
for pin in $pins; do
   echo $pin > /sys/class/gpio/export
   echo high > /sys/class/gpio/gpio$pin/direction
done
# 2-5, 22,23,26,27 Drive select and head select, set inactive
# 8-11 REVB head
# 50 read transceiver enable, low enabled
pins="2 3 4 5 8 9 10 11 22 23 26 27 50"
for pin in $pins; do
   echo $pin > /sys/class/gpio/export
   echo low > /sys/class/gpio/gpio$pin/direction
done

# 30 track 0, 46 REVB pin
pins="30 46"
for pin in $pins; do
   echo $pin > /sys/class/gpio/export
   echo in > /sys/class/gpio/gpio$pin/direction
done

# Enable A/D
echo cape-bone-iio > /sys/devices/bone_capemgr.*/slots

REV=`cat /sys/class/gpio/gpio46/value`
if [ $REV == '0' ]; then
   echo Rev B Board
else
   echo Rev A Board
fi

